version: 2.1

jobs:
  build-and-deploy:
    docker:
      - image: cimg/node:20.9
    environment:
      NODE_ENV: production
    steps:
      - checkout

      - run:
          name: Instalar dependências
          command: npm ci
                
      - run:
          name: Mostrar diretório atual
          command: pwd

      - run:
          name: Listar arquivos e pastas da raiz
          command: ls -la

      - run:
          name: Listar conteúdo da pasta node_modules/.bin
          command: ls -la node_modules/.bin || echo "node_modules/.bin não existe"

      - run:
          name: Mostrar caminho do Vite (se existir)
          command: which vite || echo "vite não encontrado no PATH"

      - run:
          name: Build do Vite
          command: ./node_modules/.bin/vite build

      - run:
          name: Chamar Deploy Hook da Render
          command: curl -X POST $RENDER_DEPLOY_HOOK_FRONTEND

workflows:
  deploy:
    jobs:
      - build-and-deploy
